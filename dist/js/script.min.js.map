{"version":3,"sources":["m-config.js","m-service.js","m-init.js","m-template.js","m-search.js","m-tabs.js","m-geo.js","m-validate.js","overlay.js","toast.js","houston-we-have-a-problem.js","element-counter.js","vm-main.js","debug.js","storage.js","map.js","main-page.js","common.js","product.js","optics.js","ui-input.js","template.js","catalog.js","order.js","profile.js","cart.js","minicart.js","thanks.js","feedback.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrDA;AACA;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxIA;AACA;AACA;AACA;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.min.js","sourcesContent":["var Config = (function () {\r\n  var _export = {\r\n    debug: {\r\n      todo: true,\r\n      consoleDebugger: true\r\n    },\r\n    pharmacy: {\r\n      queryPath: '/data/pharmacyList.json'\r\n    },\r\n    responsive: {\r\n      mobileEnabled: false,\r\n      state: 0,\r\n      mobileWidth: 768\r\n    },\r\n    price: {\r\n      minPrice: 0,\r\n      maxPrice: 10000,\r\n      orderMinPrice: 100,\r\n      maxDiscountCost: 5000,\r\n      maxDiscountProgress: 6000,\r\n      discountProgressStageValues: [{\r\n        price: 1500,\r\n        percent: 3\r\n      },\r\n      {\r\n        price: 3000,\r\n        percent: 5\r\n      },\r\n      {\r\n        price: 5000,\r\n        percent: 7\r\n      }]\r\n    },\r\n    structure: {\r\n      pharmacy: {\r\n        pharmacyId: 1,\r\n        adress: '',\r\n        city: '',\r\n        time: ''\r\n      }\r\n    },\r\n    strings: {\r\n      rareSubmit: \"Наш сотрудник свяжется с вами в течении 15 минут\",\r\n      feedbackSubmit: \"Ваше сообщение успешно отправлено\",\r\n      feedbackSubscribe: \"Спасибо,что подписались на нашу рассылку. Теперь вы сможете получать актуальную информацию о наших акциях и спец. предложениях. Для подтверждения подписки перейдите по ссылке в письме.\",\r\n      inputValidationFailed: \"Одно или несколько полей заполнены неверно\"\r\n    },\r\n    contact: {\r\n      tirkai: '<a href=\"http://t.me/tirkai\">Tirkai</a>',\r\n      pavero: '<a href=\"http://t.me/pavero777\">Pavero</a>'\r\n    }\r\n  };\r\n  return _export;\r\n})();\r\n","var Service = (function () {\r\n  var _export = {\r\n    defaultValue: function (value, def) {\r\n      return value != undefined ? value : (def != undefined ? def : null);\r\n    },\r\n    checkPageUrl: function (page) {\r\n      return location.pathname.indexOf(page) > -1;\r\n    },\r\n    initComponent: function (componentId, handler) {\r\n      handler();\r\n      $(\"#\" + componentId).remove();\r\n    },\r\n    randomRange: function (min,max) {\r\n      return Math.floor(Math.random() * (max - min) + min);\r\n    },\r\n    keywordInitElementId: function (keyword, callback) {\r\n      $(document).ready(function () {\r\n        if($(\".\" + keyword).length) callback();  \r\n      });\r\n    },\r\n    scoped: function(callback){\r\n      return callback();\r\n    }\r\n  };\r\n  return _export;\r\n}());\r\n","var Init = (function () {\r\n  function init(){\r\n    _export.customScroll();\r\n    _export.searchField();\r\n    _export.yandexMap();\r\n    _export.fancybox();\r\n    _export.tabs();\r\n    _export.feedback();\r\n    _export.wavesEffect();\r\n  }\r\n  var _export = {\r\n    customScroll: function (el) {\r\n      el = Service.defaultValue(el,\".js-custom-scroll\");\r\n      $(el).each(function (i, item) {\r\n        if($(item).height() >= 0) $(item).customScroll();\r\n      });\r\n\r\n      if($(window).width() < 768){\r\n        /* $(\".js-custom-scroll-mobile\").each(function (i, item) {\r\n          console.log($(item));\r\n          $(item).customScroll();\r\n        });\r\n      } else {\r\n        $(\".js-custom-scroll-mobile\").each(function (i, item) {\r\n          $(item).customScroll(\"destroy\");\r\n        }); */\r\n        (function(){\r\n          $(\".card-list\").each(function(i, item){\r\n            var childCount = $(this).children().length;\r\n            $(this).css({width: childCount * 270 + \"px\"});\r\n          });\r\n        }());\r\n      }\r\n    },\r\n    searchField: function (el) {\r\n      SearchField.bindFocusEvent(el);\r\n    },\r\n    yandexMap: function (el) {\r\n      YandexMap.buildMap();\r\n    },\r\n    fancybox: function () {\r\n      $.fancybox.defaults.beforeLoad = function () {\r\n        $(\"html,body\").css({overflow:\"hidden\"});\r\n        $(\".search-form_is-pinned\").css({paddingRight: \"17px\"});\r\n      };\r\n      $.fancybox.defaults.afterClose = function () {\r\n        $(\"html,body\").css({overflow:\"auto\"});\r\n        $(\".search-form_is-pinned\").css({paddingRight: \"0\"});\r\n      };\r\n      $.fancybox.defaults.touch = false;\r\n      $(\".js-fancybox-close\").on(\"click\",function () {\r\n        $.fancybox.close();\r\n      });\r\n      $.fancybox.defaults.animationEffect = \"zoom-in-out\";\r\n      $.fancybox.defaults.animationDuration = 250;\r\n    },\r\n    tabs: function (el) {\r\n      Tabs.init(el);\r\n    },\r\n    feedback: function () {\r\n      $(\".js-popup-feedback-show\").on(\"click\",function () {\r\n        Feedback.showPopup({\r\n          action: $(this).attr(\"data-action\")\r\n        });\r\n      });\r\n    },\r\n    wavesEffect: function (el) {\r\n      el = Service.defaultValue(el,\"\");\r\n      Waves.attach(el + ' .product__amount-inc,.product__amount-dec,.product__delete,.button:not(.button_disabled)');\r\n      Waves.init();\r\n    }\r\n  };\r\n  $(document).ready(function () {\r\n    init();\r\n  });\r\n  return _export;\r\n})();\r\n","var Template = (function () {\r\n  var _export = {\r\n    html: function (params) {\r\n      $(params.selector).html(params.data);\r\n    },\r\n    append: function (params) {\r\n      $(params.selector).append(params.data);\r\n    },\r\n    prepend: function (params) {\r\n      $(params.selector).prepend(params.data);\r\n    },\r\n    requireComponent: function (params) {\r\n      params.templateParams = Service.defaultValue(params.templateParams,{});\r\n      $.ajax({\r\n        url: params.path + \"?\" + $.param(params.templateParams),\r\n        success: function (resp) {\r\n          params.handler({\r\n            data: resp,\r\n            selector: params.selector\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n  return _export;\r\n})();\r\n","var SearchField = (function () {\r\n\r\n  function init(){\r\n    $(\".search-field\").each(function (i, item) {\r\n      _export.bindFocusEvent($(item));\r\n    });\r\n  }\r\n  var _export = {\r\n    bindFocusEvent: function (el) {\r\n      el = Service.defaultValue(el,\".search-field\");\r\n      $(el).each(function (i, item) {\r\n        var inputField = $(item).find(\".search-field__input\");\r\n        inputField.on(\"focus\",function () {\r\n          $(item).addClass(\"search-field_focused\");\r\n        });\r\n        inputField.on(\"blur\",function () {\r\n          $(item).removeClass(\"search-field_focused\");\r\n        });\r\n      });\r\n    },\r\n    updateLiveSearch: function (data) {\r\n      var result = \"\";\r\n      if(!data.length) data.push({\r\n        value: \"Ничего не найдено\",\r\n        url: \"#\"\r\n      });\r\n      data.forEach(function (item, i) {\r\n        var searchItemTemplate = `\r\n          <div class=\"search-field__live-search__item\">\r\n            <a href=\"${data[i].url}\">\r\n              ${data[i].value}\r\n            </a>\r\n          </div>\r\n        `;\r\n        result += searchItemTemplate;\r\n      });\r\n      $(\".search-field__live-search\").html(result);\r\n    }\r\n  };\r\n  return _export;\r\n}());\r\n","var Tabs = (function () {\r\n  var tabsList = [];\r\n  function init(el) {\r\n    $(Service.defaultValue(el,\".tabs\")).each(function (i, tabs) {\r\n      tabsList.push(new TabsElement({\r\n        tabsId: $(tabs).attr(\"data-tabs\"),\r\n        tabsContainer: $(tabs).find(\".tabs__container\"),\r\n        tabsControl: $(tabs).find(\".tabs__control__item\"),\r\n        tabsContent: $(tabs).find(\".tabs__content\")\r\n      }));\r\n      tabsList.forEach(function (tabs, index) {\r\n        $(tabs.tabsControl).each(function (i, item) {\r\n          var controlId = $(item).attr(\"data-tab-control\");\r\n          $(item).on(\"click\",function () {\r\n           tabsList[index].changeTab(controlId);\r\n          });\r\n          if(i == 0) tabsList[index].changeTab(controlId);\r\n        });\r\n      });\r\n    });\r\n    console.log($(\".tabs\"));\r\n  }\r\n  var TabsElement = function (params) {\r\n    var _this = this;\r\n    this.tabsId = params.tabsId;\r\n    this.tabsContainer = params.tabsContainer;\r\n    this.tabsControl = params.tabsControl;\r\n    this.tabsContent = params.tabsContent;\r\n    this.changeTab = function (id) {\r\n      $(_this.tabsControl).each(function () {\r\n        var tabsControl = $(this);\r\n        if(tabsControl.attr(\"data-tab-control\") == id){\r\n          tabsControl.addClass(\"tabs__control__item_is-active\");\r\n          $(_this.tabsContent).each(function (i, item) {\r\n            var tabsContent = $(this);\r\n            if(tabsContent.attr(\"data-tab-content\") == id) tabsContent.show();\r\n            else tabsContent.hide();\r\n          });\r\n        } else {\r\n          tabsControl.removeClass(\"tabs__control__item_is-active\");\r\n        }\r\n      });\r\n    };\r\n  };\r\n  return {\r\n    getTabsList: function () {\r\n      return tabsList;\r\n    },\r\n    init: function () {\r\n      init();\r\n    }\r\n  };\r\n}());\r\n","// Тут была великая империя, но она рухнула под весом правок\r\n   ","var Validate = (function () {\r\n  var patterns = {\r\n    fio: /^[a-zA-Z]{3,7}$/,\r\n    email: /^([a-z0-9_\\.-])+@[a-z0-9-]+\\.([a-z]{2,4}\\.)?[a-z]{2,4}$/i,\r\n    phone: /^(\\s*)?(\\+)?([- _():=+]?\\d[- _():=+]?){6,14}(\\s*)?$/\r\n  };\r\n  var _export = {\r\n    bindHandler: function (items) {\r\n      console.log(items);\r\n      items.forEach(function (item) {\r\n        $(item.element).on(\"blur\",function () {\r\n          $(this).attr(\"data-focused\",\"true\");\r\n        });\r\n      });\r\n    },\r\n    checkValid: function (items,callback) {\r\n      var result = {\r\n        totaly: false,\r\n        conditions: []\r\n      };\r\n      items.forEach(function (item, i, arr) {\r\n        var itemValue = $(item.element).val();\r\n        var itemElement = $(item.element);\r\n        var itemResult = false;\r\n        if(item.condition == \"pattern\"){\r\n          itemResult = patterns[item.pattern].test(itemValue) || (!item.required ? (itemValue == \"\") : false);\r\n          result.conditions.push(itemResult);\r\n        }\r\n        //console.log(item.condition);\r\n        if(item.condition == \"length\"){\r\n          //console.log(\"length: /\" + itemValue + \"/ \" + item.params.min + \" \" + item.params.max);\r\n          itemResult = itemValue.length.toString() >= item.params.min && itemValue.length.toString() <= item.params.max;\r\n          itemResult = itemResult || (!item.required ? (itemValue == \"\") : false);\r\n          result.conditions.push(itemResult);\r\n          //console.log(\"length res\" + (itemValue >= item.params.min && itemValue <= item.params.max));\r\n        }\r\n        if(item.condition == \"checked\"){\r\n          itemResult = $(item.element).prop(\"checked\");\r\n          result.conditions.push(itemResult);\r\n        }\r\n        if(itemResult && typeof item.success == \"function\") item.success(itemResult);\r\n        else if(typeof item.error == \"function\" && $(itemElement).attr(\"data-focused\")) item.error(itemResult);\r\n        //console.log(result);\r\n      });\r\n      var countValidConditions = 0;\r\n      result.conditions.forEach(function (item, i, arr) {\r\n        if(item) countValidConditions++;\r\n        //console.log(countValidConditions + \" - \" + result.conditions.length);\r\n      });\r\n\r\n      result.totaly = (countValidConditions == result.conditions.length);\r\n      if(result.totaly) callback.success();\r\n      else callback.error();\r\n    }\r\n  };\r\n  return _export;\r\n}());\r\n\r\n/*\r\n\r\n[\r\n{\r\n element: \"#order_fio_input\",\r\n condition: \"pattern\",\r\n pattern: \"email\",\r\n success: \"\"\r\n}\r\n]\r\n*/\r\n","var Overlay = (function(){\r\n    var $overlay = $(\".overlay\");\r\n    return {\r\n        show: function(callback){\r\n            $overlay.addClass(\"overlay_active\");\r\n            $overlay.one(\"click\",function(){\r\n                Overlay.hide();\r\n                callback();\r\n            });\r\n            console.log(this);\r\n        },\r\n        hide: function(){\r\n            $overlay.removeClass(\"overlay_active\"); \r\n            $overlay.unbind();\r\n        }\r\n    }\r\n}());","var Toast = (function () {\r\n  var toastsList = [];\r\n  function init(){\r\n    $(document).ready(function () {\r\n      $(\"body\").append('<div class=\"toast-container\"></div>');\r\n    });\r\n  }\r\n  var defaultValue = function (checkedValue,defaultValue) {\r\n    return (checkedValue != undefined) ? checkedValue : defaultValue;\r\n  };\r\n  var ToastItem = function (params) {\r\n    var toast = this;\r\n    toast.id = toastsList.length;\r\n    toast.title = defaultValue(params.title,\"\");\r\n    toast.content = params.content;\r\n    toast.type = params.type;\r\n    toast.timeout = params.timeout;\r\n    toast.callback = params.callback;\r\n    toast.getElement = function () {\r\n      return $(\"#toast-\" + toast.id);\r\n    };\r\n    toast.destroy = function () {\r\n      toast.element.css({\r\n        \"opacity\": \"0\",\r\n        \"max-width\": \"50px\",\r\n        \"margin-bottom\": \"-50px\",\r\n        \"line-height\": \"0\"\r\n      });\r\n      setTimeout(function () {\r\n        toast.getElement().remove();\r\n        delete toastsList[toast.id];\r\n      },500);\r\n\r\n    };\r\n    toast.show = function () {\r\n      var htmlContainer = $(\".toast-container\");\r\n      toast.element = htmlContainer.prepend('<div class=\"toast-item ' + defaultValue(toast.type,\"success\") + '\" id=\"toast-' + toast.id + '\"><div class=\"toast-title\">' + toast.title + '</div><div class=\"toast-content\">' + toast.content + '</div></div>').find(\"#toast-\" + toast.id);\r\n      setTimeout(function () {\r\n        toast.element.css({\r\n          \"max-width\": \"100%\",\r\n          \"color\": \"white\",\r\n          \"margin-bottom\": \"5px\",\r\n        });\r\n        setTimeout(function () {\r\n          toast.element.css(\"line-height\",\"1.2em\");\r\n        },300);\r\n      },20);\r\n\r\n      toast.getElement().on(\"click\",function () {\r\n        if(typeof toast.callback == \"function\") toast.callback();\r\n        else toast.destroy();\r\n      });\r\n      setTimeout(toast.destroy,defaultValue(toast.timeout,3000));\r\n    };\r\n  };\r\n  init();\r\n\r\n  return {\r\n    createToast: function (contentParams,configParams) {\r\n      var toast = new ToastItem(contentParams);\r\n      toastsList.push(toast);\r\n      toast.show();\r\n    },\r\n    clearToasts: function (params) {\r\n      toastsList.forEach(function (item, i, arr) {\r\n        item.destroy();\r\n      });\r\n    },\r\n    getToastsList: function () {\r\n      return toastsList;\r\n    }\r\n  };\r\n}());\r\n","(function () {\r\n  if(Config.debug.todo){\r\n    var todoEl = $(\"._dev-todo\");\r\n    var createProblem = function(url,text){\r\n      if(Service.checkPageUrl(url)){\r\n        $(todoEl).show();\r\n        $(todoEl).on(\"click\",function () {\r\n          $(this).hide();\r\n        });\r\n        $(todoEl).html(text);\r\n      }\r\n    };\r\n  }\r\n\r\n}());\r\n","var Counter = (function(){\r\n    return {\r\n        init: function(){\r\n            alert(\"ALLAH\");\r\n        }\r\n    }\r\n}());   ","/*\r\nvar vmApp;\r\n$(document).ready(function () {\r\n  vmApp = new Vue({\r\n    el: \"#main\",\r\n    components: {\r\n    },\r\n    data: {\r\n      currentPharmacyObject: [Config.structure.pharmacy],\r\n      geoProps: {\r\n        focusPharmacy: Config.structure.pharmacy\r\n      }\r\n    },\r\n    methods: {\r\n      setCurrentPharmacy: function (pharmacy) {\r\n        this.$set(this.currentPharmacyObject, 0, pharmacy);\r\n      }\r\n    },\r\n    computed: {\r\n      currentPharmacy: function() {\r\n        return this.currentPharmacyObject[0];\r\n      }\r\n    },\r\n    mounted: function () {\r\n      var pd = JSON.parse(localStorage.getItem(\"user_geo_data\"));\r\n      if(pd) this.setCurrentPharmacy(pd);\r\n      else $.ajax({\r\n        url: Config.pharmacy.queryPath,\r\n        success: function (resp) {\r\n          vmApp.setCurrentPharmacy(resp[0]);\r\n        },\r\n      });\r\n      if(this.watcherEnabled) $.ajax({url: \"/data/watcher.txt\",success: function (r) {console.log(r);}});\r\n    }\r\n  });\r\n});\r\n*/\r\n","var _Debug = (function () {\r\n  $(document).ready(function () {\r\n    if(localStorage.getItem(\"_debug_mark-edges\") == \"true\"){\r\n      _export.markEdges(localStorage.getItem(\"_debug_mark-edges\"));\r\n    }\r\n  });\r\n  var _export = {\r\n    markEdges: function (state) {\r\n      var selector = \"*\";\r\n      if(state){\r\n        $(selector).addClass(\"_mark-edges\");\r\n      } else {\r\n        $(selector).removeClass(\"_mark-edges\");\r\n      }\r\n      localStorage.setItem(\"_debug_mark-edges\",state);\r\n    }\r\n  };\r\n  return _export;\r\n})();\r\n","","var YandexMap = (function () {\r\n  // Get Json Data\r\n  var pharmacyData = \"\";\r\n  $.ajax({\r\n    url: \"/data/pharmacyList.json\",\r\n    success: function (resp) {\r\n      pharmacyData = resp;\r\n    }\r\n  });\r\n\r\n    function initMap() {\r\n      _export.inited = true;\r\n          var mapCenter = [54.513527, 36.246636],\r\n              map = new ymaps.Map('map', {\r\n                  center: mapCenter,\r\n                  zoom: 9,\r\n                  controls: []\r\n              },{\r\n                geoObjectOpenBalloonOnClick: false\r\n              }),\r\n              placemarks = [];\r\n\r\n\r\n\r\n          var clusterer = new ymaps.Clusterer({\r\n              clusterDisableClickZoom: false,\r\n              clusterOpenBalloonOnClick: true,\r\n          });\r\n          pharmacyData.forEach(function (item, i, arr) {\r\n            var placemark = new ymaps.Placemark(item.coords, {\r\n                balloonContentHeader: (i + 1),\r\n                balloonContentBody: 'Информация о метке №' + (i + 1),\r\n                placemarkId: i\r\n            });\r\n            placemarks.push(placemark);\r\n          });\r\n\r\n\r\n          clusterer.add(placemarks);\r\n          map.geoObjects.add(clusterer);\r\n\r\n          map.geoObjects.events.add('click', function (e) {\r\n            var id = (e.get('target').properties.get(\"placemarkId\"));\r\n            console.log(pharmacyData);\r\n            //if(!isNaN(id)) vmGeoHelper.geoComponentContext.confirmPharmacy(id);\r\n          });\r\n        }\r\n  var _export = {\r\n    inited: false,\r\n    buildMap: function () {\r\n      var mapLoadAwait = setTimeout(function () {\r\n        if(typeof ymaps != \"object\") mapLoadAwait();\r\n        else if($(\"#map\").length) initMap();\r\n      },1000);\r\n    }\r\n  };\r\n  return _export;\r\n})();\r\n","Service.keywordInitElementId(\"slider\",function () {\r\n  var $slider = $(\".slider\");\r\n  var $sliderItems = $slider.find(\".slider__container__item\");\r\n  var $pointItems = $slider.find(\".slider__container__points__item\");\r\n  var slideId = -1;\r\n  var timer = null;\r\n  var changeTimeout = null;\r\n  var changeSlide = function (value, isSet) {\r\n    if(isSet){\r\n      slideId = value;\r\n    } else {\r\n      slideId += value;\r\n      if(slideId >= $sliderItems.length) slideId = 0;\r\n      if(slideId < 0) slideId = $sliderItems.length - 1;\r\n    }\r\n    $sliderItems.each(function (i, item) {\r\n      if($(item).attr(\"data-slide\") == slideId){\r\n        $(item).show();\r\n        $(item).addClass(\"slider__container__item_is-show\");\r\n      } else {\r\n        $(item).removeClass(\"slider__container__item_is-show\");\r\n        setTimeout(function () {\r\n          $(item).hide();\r\n        },300);\r\n      }\r\n    });\r\n    $pointItems.each(function (i, item) {\r\n      if($(item).attr(\"data-slider-point\") - 1 == slideId){\r\n        $(item).addClass(\"slider__container__points__item_active\");\r\n      } else {\r\n        $(item).removeClass(\"slider__container__points__item_active\");\r\n      }\r\n    });\r\n  };\r\n  var arrowNavigate = function (params) {\r\n    clearTimeout(changeTimeout);\r\n    changeTimeout = setTimeout(function () {\r\n      changeSlide(params.value, false);\r\n      clearTimeout(timer);\r\n      loop();\r\n    },300);\r\n  };\r\n  var loop = function () {\r\n    timer = setTimeout(function () {\r\n      changeSlide(1,false);\r\n      loop();\r\n    },5000);\r\n  };\r\n  (function () {\r\n    changeSlide(1);\r\n    loop();\r\n  })();\r\n\r\n  $pointItems.on(\"click\",function () {\r\n    var pointId = $(this).attr(\"data-slider-point\") - 1;\r\n    clearTimeout(changeTimeout);\r\n    changeTimeout = setTimeout(function () {\r\n      changeSlide(pointId,true);\r\n      clearTimeout(timer);\r\n      loop();\r\n    },300);\r\n\r\n  });\r\n\r\n  $(\".slider__container__nav__item_left\").on(\"click\",function () {\r\n    arrowNavigate({\r\n      value: -1,\r\n      element: $(this)\r\n    });\r\n  });\r\n  $(\".slider__container__nav__item_right\").on(\"click\",function () {\r\n    arrowNavigate({\r\n      value: 1,\r\n      element: $(this)\r\n    });\r\n  });\r\n});\r\nService.keywordInitElementId(\"review\",function () {\r\n  var review = $(\".review\");\r\n  if(review.length){\r\n    var reviewData = {};\r\n    var reviewCurrentId = 0;\r\n    var reviewText = review.find(\".review-container__content__data__text\"),\r\n        reviewName = review.find(\".js-review-name\"),\r\n        nextArrow = review.find(\".review-container__arrow-right\"),\r\n        prevArrow = review.find(\".review-container__arrow-left\");\r\n    var updateReview = function (value) {\r\n      console.log(reviewCurrentId + \" / \" + reviewData.length);\r\n      reviewCurrentId += value;\r\n      if(reviewCurrentId >= reviewData.length) reviewCurrentId = 0;\r\n      if(reviewCurrentId < 0) reviewCurrentId = reviewData.length - 1;\r\n      var reviewItem = reviewData[reviewCurrentId];\r\n      review.find(\".review-container__content\").css(\"opacity\",\"0\");\r\n      setTimeout(function () {\r\n        reviewText.html(reviewItem.text);\r\n        reviewName.html(reviewItem.name);\r\n        review.find(\".review-container__content\").css(\"opacity\",\"1\");\r\n      },500);\r\n    };\r\n    $.post(\"/data/reviews.json\").then(function(resp){\r\n      reviewData = resp;\r\n      updateReview(0);\r\n    });\r\n    nextArrow.on(\"click\",function () {\r\n      updateReview(1);\r\n    });\r\n    prevArrow.on(\"click\",function () {\r\n      updateReview(-1);\r\n    });\r\n  }\r\n});\r\nService.keywordInitElementId(\"subscribe__form\",function () {\r\n  $(\".subscribe__form\").on(\"submit\",function (e) {\r\n    var $self = $(this);\r\n    e.preventDefault();\r\n    var validateItems = [\r\n    {\r\n        element: \"#subscribe__form__input\",\r\n        condition: \"pattern\",\r\n        pattern: \"email\",\r\n        required: true\r\n    },\r\n    ];\r\n    Validate.checkValid(validateItems,{\r\n      success: function () {\r\n        Feedback.sendSubscribe($self);\r\n      },\r\n      error: function () {\r\n        Toast.createToast({\r\n          content: Config.strings.inputValidationFailed,\r\n          type: \"error\"\r\n        });\r\n      }\r\n    });\r\n  });\r\n});\r\n","(function () {\r\n  \r\n}());\r\n","// Product.js\r\nService.keywordInitElementId(\"product\",function () {\r\n  var $product = $(\".product\");\r\n  var totalPrice = 0;\r\n  var withoutDiscountTotal = 0;\r\n  var progressiveDiscount = function (total, progressive) {\r\n    // Расчет прогрессивной скидки\r\n    var discount = progressive, percent = 0;\r\n    Config.price.discountProgressStageValues.forEach(function (item, i) {\r\n      if(progressive >= item.price) {\r\n        discount = progressive - (progressive / 100 * item.percent);\r\n        percent = item.percent;\r\n        //console.log(\"itemPriceStage:\" + item.price + \";\\ndiscount: \" + discount + \";\\npercent: \" + item.percent);\r\n      }\r\n    });\r\n    return {\r\n      price: discount,\r\n      percent: percent\r\n    };\r\n  };\r\n\r\n  var calculateTotal = function () {\r\n    // Рассчет итоговой стоимости. Карл Фридрих Гаусс вертится в гробу вырабатывая электричество для наших серверов.\r\n    totalPrice = 0;\r\n    var progressivePrice = 0;\r\n    var defaultPrice = 0;\r\n    $product.each(function (i, item) {\r\n      var $itemPrice = $(item).find(\".product__price__input\");\r\n      var $itemCount = $(item).find(\".product__count__input\");\r\n      var itemDiscount = !!($itemPrice.attr(\"data-discount\"));\r\n      if(itemDiscount){\r\n        defaultPrice += parseFloat($itemPrice.val()) * parseInt($itemCount.val());\r\n      } else {\r\n        progressivePrice += parseFloat($itemPrice.val()) * parseInt($itemCount.val());\r\n      }\r\n      withoutDiscountTotal = (progressivePrice + defaultPrice);\r\n      var progressiveDiscountCalculated = progressiveDiscount(withoutDiscountTotal,progressivePrice);\r\n      totalPrice = (progressiveDiscountCalculated.price + defaultPrice);\r\n      if(progressivePrice > 0){\r\n        $(\".js-cart-discount-percent\").html(progressiveDiscountCalculated.percent);\r\n        $(\".stages__cart__action__next__summary__price__basic\").css(\"display\", progressiveDiscountCalculated.percent > 0 ? \"block\" : \"none\");\r\n      } else {\r\n        $(\".js-cart-discount-percent\").html(\"0\");\r\n        $(\".stages__cart__action__next__summary__price__basic\").css(\"display\", \"none\");\r\n      }\r\n      //console.log(\"prog: \" + progressivePrice + \" def: \" + defaultPrice + \" total: \" + totalPrice);\r\n      //console.log(\"discount: \" + progressiveDiscount(withoutDiscountTotal,progressivePrice).price);\r\n    });\r\n    // FUCKING MATH\r\n    $(\".js-cart-basic-price\").html((parseFloat(withoutDiscountTotal).toFixed(2)))\r\n    $(\".js-cart-total-price\").html((parseFloat(totalPrice).toFixed(2)));\r\n  };\r\n  $product.each(function (i, item) {\r\n    // Изменение количества товара. О да как я люблю длинные названия.\r\n    // Деструкторизация? Не не слышал...\r\n    var $amountCountInput = $(item).find(\".product__count__input\");\r\n    var $amountPriceInput = $(item).find(\".product__price__input\");\r\n    var $amountCountElement = $(item).find(\".product__amount-count\");\r\n    var $amountCountSummary = $(item).find(\".product__sum .price-now\");\r\n    var $amountFormChange = $(item).find(\".row-product__form-change\");\r\n    var summaryCount = parseInt($amountCountInput.val());\r\n    var changeValue = function (modify) {\r\n      console.log(\"[CHANGE VALUE]\");\r\n      console.log(\"[]\" +  $amountCountInput.attr(\"data-maxcount\"));\r\n      summaryCount += modify;\r\n      var chekoutAvailable = summaryCount <= parseInt($amountCountInput.attr(\"data-maxcount\"));\r\n      if(summaryCount > 0 && summaryCount < 100 && chekoutAvailable){\r\n        Service.keywordInitElementId(\"stages__cart\",function () {\r\n           $amountFormChange.submit();\r\n        });\r\n        $amountCountInput.val(summaryCount);\r\n        $amountCountElement.text(summaryCount);\r\n        $amountCountSummary.text((summaryCount * parseFloat($amountPriceInput.val())).toFixed(2) + \" руб.\");\r\n        /*\r\n        awaitStatus().then(function () {\r\n          $amountCountInput.val(summaryCount);\r\n          $amountCountElement.text(summaryCount);\r\n          $amountCountSummary.text((summaryCount * parseFloat($amountPriceInput.val())).toFixed(2) + \" руб.\");\r\n        }).catch(function () {\r\n          Cart.setResponseState(true);\r\n        });\r\n        */\r\n\r\n      } else {\r\n        if(!chekoutAvailable) Toast.createToast({\r\n          type: \"error\",\r\n          content: \"Выбранного количества нет в наличии, на остатке \" + $amountCountInput.attr(\"data-maxcount\")\r\n        })\r\n        summaryCount += -(modify)\r\n      };\r\n      Service.keywordInitElementId(\"stages__cart\",calculateTotal);\r\n    };\r\n    $(item).find(\".product__amount-inc\").on(\"click\",function () {\r\n      changeValue(1);\r\n    });\r\n    $(item).find(\".product__amount-dec\").on(\"click\",function () {\r\n      changeValue(-1);\r\n    });\r\n    calculateTotal();\r\n  });\r\n\r\n  $product.each(function (i, item) {\r\n    // Вроде как удаление товара. Думаю половина из этого не нужно, но вот какая именно половина вопрос\r\n    var isDeleted = false;\r\n    $(item).find(\".js-delete-product\").on(\"click\",function () {\r\n      if(!isDeleted){\r\n        isDeleted = true;\r\n        $(item).find(\".product__price__input\").val(\"0\");\r\n        calculateTotal();\r\n        $(item).addClass(\"product_removed\");\r\n        $(item).find(\".row-product__form-delete\").submit();\r\n        setTimeout(function () {\r\n          $(item).remove();\r\n          if($(\".product\").length < 1){\r\n            location.reload();\r\n          }\r\n        },300);\r\n      }\r\n\r\n    });\r\n  });\r\n  $(\".js-order-confirm\").on(\"click\",function (e) {\r\n    // Не даем продолжить заказ пока не набрана минимальная сумма\r\n    if(totalPrice < Config.price.orderMinPrice){\r\n      e.preventDefault();\r\n      Toast.createToast({\r\n        content: \"Минимальная сумма заказа \" + Config.price.orderMinPrice + \" руб.\",\r\n        type: \"error\"\r\n      });\r\n    }\r\n  });\r\n  Service.keywordInitElementId(\"product-page__container__description__item\",function () {\r\n    // Спойлеры описания товара\r\n    var $descItem = $(\".product-page__container__description__item\");\r\n    var showSelector = \"product-page__container__description__item__text_is-show\";\r\n    $descItem.on(\"click\",\".js-product-desc-title\",function () {\r\n      var $text = $(this).next();\r\n      if(!$text.hasClass(showSelector)) $text.addClass(showSelector);\r\n      else $text.removeClass(showSelector);\r\n    })\r\n    $descItem.each(function (i, item) {\r\n      // Хоть как то форматируем ущербно приходящие данные.\r\n      var content = $(item).html();\r\n      content = content\r\n              .split(\";\").join(\";<br>\")\r\n              .split(\".\").join(\". \")\r\n              .split(\":\").join(\": \");\r\n      $(item).html(content);\r\n    });\r\n\r\n  });\r\n});\r\n","var Optics = (function () {\r\n    var orderList = [];\r\n    var _export = {\r\n        getValueBySelect: function ($el) {\r\n            return $($el).find(\"select\").val();\r\n        },\r\n        createOrder: function (order) {\r\n            orderList = order;\r\n            $.post(\"/endpoints/optics.php\", { optics: this.getOrder() }).then(function (resp) {\r\n                console.log(JSON.parse(resp));\r\n            }).catch(function () {\r\n                alert(\"something wrong\");\r\n            });\r\n            return false;\r\n        },\r\n        getOrder: function () {\r\n            return orderList;\r\n        },\r\n        sendOrder(e) {\r\n            \r\n        }\r\n    };\r\n    return _export;\r\n}());\r\n\r\nService.keywordInitElementId(\"optics-product\", function () {\r\n    $(\".js-optics-order\").on(\"click\", function () {\r\n        $.fancybox.open({src:\"#popup_order_optics\", type:\"inline\"});\r\n    });\r\n    $(\".js-optics-send\").on(\"submit\",function(e){\r\n        e.preventDefault();\r\n        alert(e);\r\n        var personArray = $(this).serializeArray();\r\n        var personInfo = {};\r\n        for(var item of personArray){\r\n            personInfo[item.name] = item.value;\r\n        }\r\n        console.log(personInfo);\r\n        Optics.createOrder({\r\n            id: $(\".ms2_form > input[name='id']\").val(),\r\n            params: {\r\n                left: {\r\n                    opticalStrength: Optics.getValueBySelect(\"#optical-strength-left\"),\r\n                    opticalRadius: Optics.getValueBySelect(\"#optical-radius-left\"),\r\n                    count: 0\r\n                },\r\n                right: {\r\n                    opticalStrength: Optics.getValueBySelect(\"#optical-radius-left\"),\r\n                    opticalRadius: Optics.getValueBySelect(\"#optical-radius-left\"),\r\n                    count: 0\r\n                }\r\n            },\r\n            person: {\r\n                name: personInfo.name,\r\n                phone: personInfo.phone\r\n            }\r\n        });\r\n    })\r\n});\r\n","\r\nService.keywordInitElementId(\"select-element\", function(){\r\n  console.log(\"INPUT\");\r\n  var $selects = $(\".select-element\");\r\n  $selects.each(function(i,item){\r\n    var selectValue = function(value){\r\n      $native.val(value);\r\n      $header.find(\"span\").html(value);\r\n      $(item).attr({\"data-select\":value});\r\n      showContent(false);\r\n    }\r\n    var showContent = function(value){\r\n      isShow = value;\r\n      $content.css({\"display\": (isShow ? \"block\" : \"none\")});\r\n    }\r\n    var isShow = false;\r\n    var $native = $(item).find(\".select-element__native\");\r\n    var $header = $(item).find(\".select-element__header\");\r\n    var $content = $(item).find(\".select-element__content\");\r\n    var contentTemplate = \"\";\r\n    $(this).on(\"click\",\".select-element__option\",function(){\r\n      selectValue($(this).data(\"value\"));\r\n    });\r\n    $(this).on(\"click\",\".select-element__header\",function(){\r\n      showContent(true);\r\n    });\r\n    $(document).on(\"click\",function(e){\r\n      console.log($(e.target).parent() == $(item));\r\n    });\r\n    $native.children().each(function(i,item){\r\n      contentTemplate += (`\r\n        <div class=\"select-element__option\" data-key=\"${i}\" data-value=\"${$(item).attr(\"value\")}\">${$(item).attr(\"value\")}</div>\r\n      `);\r\n    });\r\n    $content.html(contentTemplate);\r\n  });\r\n});\r\n\r\n\r\n/* if($(this).hasClass(\"select-element\")){\r\n  return $(this).find(\".select-element__native\").val();\r\n} */","// Template.js\r\n$(document).ready(function () {\r\n  \r\n  Service.scoped(function () {\r\n    Inputmask({ \"mask\": \"+7 (999) 999-99-99\" }).mask(\"input[name='phone']\");\r\n  });\r\n\r\n  Service.scoped(function () {\r\n    // Pin Search Form\r\n    var $window = $(this);\r\n    var $searchForm = $(\".search-form\");\r\n    var $searchField = $searchForm.find(\".search-field\");\r\n    var currentOffset = 0;\r\n    var primaryOffset = $searchForm.offset().top;\r\n    var pinHeaderOnScroll = function () {\r\n      currentOffset = $searchForm.offset().top;\r\n      if ($window.scrollTop() > currentOffset && Config.responsive.state != 4) {\r\n        $searchForm.addClass(\"search-form_is-pinned\");\r\n        $searchField.addClass(\"search-field_grey\");\r\n      } else if ($window.scrollTop() < primaryOffset) {\r\n        $searchForm.removeClass(\"search-form_is-pinned\");\r\n        $searchField.removeClass(\"search-field_grey\");\r\n      }\r\n    }\r\n    $(window).on(\"scroll\", pinHeaderOnScroll);\r\n    $(window).trigger(\"scroll\");\r\n  });\r\n\r\n\r\n  Service.scoped(function () {\r\n    var searchQuery = function () {\r\n      window.location.href = '/catalog/?query=' + $(\".search-field__input\").val();\r\n    };\r\n    $(\".search-form__search-field__search-button\").on(\"click\", searchQuery);\r\n  });\r\n\r\n  Service.scoped(function () {\r\n    var notifyStorage = !!(localStorage.getItem(\"global-notify\"));\r\n    var $globalNotify = $(\".global-notify\");\r\n\r\n    // global notify handlers\r\n    var onButtonClick = function () {\r\n      $globalNotify.addClass(\"global-notify_expanded\");\r\n      $(\".global-notify__content\").html(\"\");\r\n      $(\".global-notify__form\").addClass(\"global-notify__form_is-show\");\r\n    };\r\n    var onFormSubmit = function (e) {\r\n      if ($(e.target).find(\"[name='comment']\").val() != \"\") {\r\n        $globalNotify.hide();\r\n        localStorage.setItem(\"global-notify\", true);\r\n      }\r\n    };\r\n    var onClose = function () {\r\n      $globalNotify.hide();\r\n      localStorage.setItem(\"global-notify\", true);\r\n    }\r\n    // global notify events\r\n    $(\".global-notify__button\").on(\"click\", onButtonClick);\r\n    $(\".global-notify__form__submit\").on(\"submit\", onFormSubmit);\r\n    $(\".js-close-global-notify\").on(\"click\", onClose);\r\n\r\n    if (!notifyStorage) $globalNotify.css({ display: \"flex\" });\r\n  });\r\n \r\n  var mobileMenu = Service.scoped(function () {\r\n    var menuOpened = false;\r\n    var $menuElement = $(\".mobile-menu\");\r\n    var $backButton = $(\".js-mobile-menu-back\");\r\n    var changeState = function () {\r\n      menuOpened = !menuOpened;\r\n      if (menuOpened){ \r\n        $menuElement.addClass(\"mobile-menu_is-enabled\");\r\n        //Overlay.show(changeState);\r\n      } else {\r\n        $menuElement.removeClass(\"mobile-menu_is-enabled\");\r\n        //Overlay.hide(changeState);\r\n      }\r\n    }\r\n    $(\".js-mobile-menu\").on(\"click\", changeState);\r\n    $(\".js-mobile-menu-back\").on(\"click\",changeState);\r\n  });\r\n  Service.scoped(function(){\r\n    var isShow = false;\r\n    var changeState = function(){\r\n      isShow = !isShow;\r\n      if(isShow){\r\n        $(\".search-form\").addClass(\"search-form_visible\");\r\n        Overlay.show(changeState);\r\n      } else {\r\n        $(\".search-form\").removeClass(\"search-form_visible\");\r\n        Overlay.hide(); \r\n      }\r\n\r\n    }\r\n    $(\".js-mobile-search\").on(\"click\",changeState);\r\n  });\r\n  Service.scoped(function () {\r\n    $(\".js-feedback-popup\").on(\"click\", function () {\r\n      $.fancybox.open({\r\n        type: \"inline\",\r\n        src: \"#popup_feedback\"\r\n      });\r\n    });\r\n    // Print page\r\n    $(\".js-print-page\").on(\"click\", window.print);\r\n  });\r\n\r\n  Service.scoped(function () {\r\n    $(\".js-order-call\").on(\"click\", function () {\r\n      $.fancybox.open({\r\n        src: \"#popup_order_call\",\r\n        type: \"inline\"\r\n      });\r\n    });\r\n  });\r\n\r\n  Service.scoped(function () {\r\n    $(\".mobile-expander\").each(function () {\r\n      var isShow = false;\r\n      var $item = $(this);\r\n      var changeExpanderState = function () {\r\n        isShow = !isShow;\r\n        var selector = $(this).data().target;\r\n        $(\"#\" + selector).css({ display: isShow ? \"block\" : \"none\" });\r\n        $item.find(\".sprite\").css({ transform: isShow ? \"rotate(180deg)\" : \"rotate(0deg)\" });\r\n      };\r\n      $(this).on(\"click\", changeExpanderState);\r\n    });\r\n  });\r\n\r\n});\r\n","\r\n// Catalog.js\r\n\r\nvar Catalog = (function () {\r\n  var _export = {\r\n    showOrderInfo: function (data) {\r\n      // Показываем попап при добавлении товара в корзину\r\n      $.fancybox.close(true);\r\n      var cost = data.data.total_cost;\r\n      var count = data.data.total_count;\r\n      $(\".js-order-info-count\").html(count);\r\n      $(\".js-order-info-cost\").html(cost);\r\n      $.fancybox.open({\r\n        type: \"inline\",\r\n        src: \"#popup_order_info\"\r\n      });\r\n      var discountProgress = (data.data.sum / Config.price.maxDiscountProgress) * 100;\r\n      $(\".js-order-info-progress\").css({\r\n        width: cost < Config.price.maxDiscountProgress ? (discountProgress > 5 ? discountProgress + \"%\": \"5%\"): \"100%\"\r\n      });\r\n    },\r\n    addToCart: function (el) {\r\n      // Често хз, зачем это надо, но когда то требовалось столь неординарное решение\r\n      if(!!window.jQuery && !!Catalog) $(el).closest(\".card__form-submit\").submit();\r\n      console.log(\"Почему бы и нет\",$(el).closest(\".card\"));\r\n      // UPD Я нашел откуда это идет. Это мастхэв фича и лучше ее не трогать.\r\n    },\r\n    orderProduct: function (el) {\r\n      var $card = $(el).parents().eq(4);\r\n      var cardContent = {\r\n        picture: $card.find(\".js-product-item-picture\").html(),\r\n        title: $card.find(\".js-product-item-title\").html(),\r\n        id: $card.find(\"input[name='id']\").val()\r\n      };\r\n      $.fancybox.open({\r\n        src: \"#popup_order_product\",\r\n        type: \"inline\"\r\n      });\r\n      $(\".js-popup-order-product-picture\").html(cardContent.picture);\r\n      $(\".js-popup-order-product-title\").html(cardContent.title);\r\n      $(\".js-popup-order-product-id\").val(cardContent.id);\r\n    },\r\n    changeCartButtonCount: function (data) {\r\n      console.log(\"changeCartButtonCount\",data.data.total_cost > 0);\r\n      var $cost = $(\".js-mini-cart-cost\");\r\n      var $count = $(\".js-mini-cart-count\");\r\n      if(data.data.total_cost > 0){\r\n        $cost.html(data.data.total_cost + \" руб.\");\r\n        $count.css({display: \"inline-flex\"});\r\n        $count.html(data.data.total_count);\r\n      } else {\r\n        $cost.html(\"Корзина\");\r\n        $count.hide();\r\n      }\r\n    }\r\n  };\r\n  return _export;\r\n})();\r\nService.keywordInitElementId(\"catalog\",function () {\r\n  $(\".catalog-container__sidebar__item\").each(function (i, item) {\r\n    //Раскрывающиеся пункты в фильтре\r\n    var expander = $(item).find(\".js-filter-expand\");\r\n    var filter = $(item).find(\".js-filter-item\");\r\n    $(expander).on(\"click\",function () {\r\n      var $icon = $(expander).find(\".icon\");\r\n      $icon.toggleClass(\"rotate180\");\r\n      $(filter).toggleClass(\"catalog-container__sidebar__item__filter_is-compress\");\r\n    });\r\n  });\r\n});\r\n","Service.keywordInitElementId(\"stages__geo\",function () {\r\n  $(\".js-geo-miss-product\").on(\"click\",function () {\r\n    $.fancybox.open({\r\n      type: \"inline\",\r\n      src: \"#popup_miss_product\"\r\n    });\r\n  });\r\n});\r\nService.keywordInitElementId(\"stages__order\",function () {\r\n  var errorText = \"Данное поле заполнено не верно\";\r\n  var validHandler = function (el,status) {\r\n    $element = $(el);\r\n    $notify = $(el + \" + .form-notify\");\r\n    if(status){\r\n      $element.removeClass(\"order__form__input_error\");\r\n      $notify.hide();\r\n    } else {\r\n      $element.addClass(\"order__form__input_error\");\r\n      $notify.show();\r\n      $notify.html(errorText);\r\n    }\r\n  };\r\n  var validateItems = [{\r\n      element: \"#order_fio\",\r\n      condition: \"length\",\r\n      params: {\r\n          min: 2,  \r\n          max: 30\r\n      },\r\n      success: function () {\r\n        validHandler(this.element,true);\r\n      },\r\n      error: function () {\r\n        validHandler(this.element,false);\r\n      }\r\n  },\r\n  {\r\n      element: \"#order_email\",\r\n      condition: \"pattern\",\r\n      pattern: \"email\",\r\n      success: function () {\r\n        validHandler(this.element,true);\r\n      },\r\n      error: function () {\r\n        validHandler(this.element,false);\r\n      }\r\n  },\r\n  {\r\n      element: \"#order_phone\",\r\n      condition: \"pattern\",\r\n      pattern: \"phone\",\r\n      required: true,\r\n      success: function () {\r\n        validHandler(this.element,true);\r\n      },\r\n      error: function () {\r\n        validHandler(this.element,false);\r\n      }\r\n  },\r\n  {\r\n    element: \"#policy_checkbox\",\r\n    condition: \"checked\",\r\n    required: true\r\n  }\r\n  ];\r\n  var checkValid = function () {\r\n    Validate.checkValid(validateItems, {\r\n    success: function() {\r\n        $(\".order__button\").removeClass(\"button_disabled\");\r\n        $(\".order__button\").attr(\"disabled\",false);\r\n    },\r\n    error: function() {\r\n        $(\".order__button\").addClass(\"button_disabled\");\r\n        $(\".order__button\").attr(\"disabled\",true);\r\n    }\r\n  });\r\n};\r\n  Validate.bindHandler(validateItems);\r\n  $(\".order__form\").find(\"input\").on(\"change\",checkValid);\r\n  setInterval(checkValid,1000);\r\n});\r\n","// Profile.js\r\n$(document).ready(function () {\r\n  if(Service.keywordInitElementId(\"profile\")){\r\n    Service.scoped(function(){\r\n      // Expand Order Item\r\n      var selector = \"profile__orders__item\";\r\n      $(\".\" + selector).each(function (i, item) {\r\n        var self = $(this);\r\n        $(item).find(\".\" + selector + \"__header\").on(\"click\",function () {\r\n          var icon = \"profile__orders__item__header__expand-icon\";\r\n          self.find(\".\" + icon).toggleClass(icon + \"_is-transform\");\r\n          self.toggleClass(selector + \"_is-expand\");\r\n        });\r\n      });\r\n\r\n      $(\".profile__orders__item__content__products__remove .button\").on(\"click\",function () {\r\n        $.fancybox.open({\r\n          type: \"inline\",\r\n          src: \"#remove_order\"\r\n        });\r\n      });\r\n\r\n      $(\".profile__popup__remove__send\").on(\"click\",function () {\r\n        $.ajax({ \r\n          type: \"POST\",\r\n          url: '/',\r\n          data: {\r\n            text: $(\".profile__popup__remove__text\").val()\r\n          },\r\n          success: function () {\r\n            $.fancybox.close();\r\n            Toast.createToast({\r\n              content: \"Ваш заказ отменен\",\r\n              type: \"success\"\r\n            });\r\n          }\r\n        });\r\n      });\r\n    })\r\n  }\r\n});\r\n","var Cart = (function () {\r\n  Service.keywordInitElementId(\"stages\",function () {\r\n    $(\".mini-cart\").hide();\r\n  });\r\n  Service.keywordInitElementId(\"stages__cart\",function () {\r\n\r\n  });\r\n  Service.keywordInitElementId(\"stages__geo\",function () {\r\n    $(\".js-popup-delivery-unavailable\").on(\"click\",function () {\r\n      $.fancybox.open({\r\n        src: \"/components/delivery-unavailable.php\",\r\n        type: \"ajax\"\r\n      });\r\n    });\r\n    $(\".js-geo-miss-product\").click(function(){\r\n          var data = $(this).data(\"missing\").split(\";\");\r\n          data.pop();\r\n          var result = \"\";\r\n          data.forEach(function (item, i) {\r\n            result += '<li>' + item + '</li>';\r\n          });\r\n          console.log(result);\r\n          $('.popup__miss-product__item__title').html(result);\r\n      });\r\n  });\r\n  return {};\r\n}());\r\n","var MiniCart = (function () {\r\n  var $list;\r\n  var $miniCartList;\r\n  Service.keywordInitElementId(\"mini-cart\",function () {\r\n    $miniCartList = $(\".mini-cart__content__list\");\r\n    $list = $(\".mini-cart__content__list__items\");\r\n    console.log(\"MCL\",$list.children().length);\r\n    if($list.children().length >= 6){\r\n      $miniCartList.customScroll();\r\n    }\r\n    $list.on(\"click\",\".mini-cart__form-delete\",function () {\r\n      var removedItemId = $(this).data(\"id\");\r\n      $(\"#\" + removedItemId).hide();\r\n    });\r\n  });\r\n  var _export = {\r\n    update: function (data) {\r\n      console.log(\"UPDATE DATA\",data);\r\n      var cart = data.data.cart;\r\n      var cartRenderElement = \"\";\r\n      cart.forEach(function (item, i) {\r\n        var miniCartItemTemplate = `\r\n          <div class=\"mini-cart__content__list__item\" id=\"mini-cart_id-${i}\">\r\n            <div class=\"mini-cart__content__list__item__el mini-cart__content__list__item__title\">\r\n              ${cart[i].name}\r\n            </div>\r\n            <div class=\"mini-cart__content__list__item__el mini-cart__content__list__item__count\">\r\n              ${cart[i].count} шт.\r\n            </div>\r\n            <div class=\"mini-cart__content__list__item__el mini-cart__content__list__item__price\">\r\n              ${cart[i].cost} руб.\r\n            </div>\r\n            <form method=\"post\" class=\"mini-cart__form-delete ms2_form\" data-id=\"mini-cart_id-${i}\">\r\n              <input type=\"hidden\" name=\"key\" value=\"${cart[i].key}\">\r\n              <button class=\"button button_round\" type=\"submit\" name=\"ms2_action\" value=\"cart/remove\">\r\n                <div class=\"row-product__delete-button sprite sprite-cart-remove\"></div>\r\n              </button>\r\n            </form>\r\n          </div>\r\n        `;\r\n        cartRenderElement += miniCartItemTemplate;\r\n      });\r\n      console.log(\"MiniCart get data: \",cart);\r\n      if(cart.length > 6) $miniCartList.customScroll();\r\n      else $miniCartList.customScroll('destroy');\r\n      $list.html(cartRenderElement);\r\n\r\n      if(cart.length > 0) $(\".mini-cart__content\").removeClass(\"hidden\");\r\n      else $(\".mini-cart__content\").addClass(\"hidden\");\r\n    },\r\n    removeItem: function (item) {\r\n      var $item = $(item).parents().eq(0);\r\n      $item.submit();\r\n      $item.hide();\r\n    }\r\n\r\n  };\r\n  return _export;\r\n})();\r\n","Service.keywordInitElementId(\"stages__thanks\",function () {\r\n  $(\".js-feedback-rate\").on(\"click\",function () {\r\n    $(\".stages__thanks__rate\").hide();\r\n    $(\".stages__thanks__feedback\").show();\r\n    $(\".js-rate-feedback-form\").on(\"submit\",function (e) {\r\n      e.preventDefault();\r\n      $.post(\"/feedback.php\", {\r\n        msg_action: \"feedback\",\r\n        comment: $(\".stages__thanks__feedback__textarea\").val()\r\n      }).then(function(resp){\r\n        $(\".js-rate-feedback-form\").html(\"Спасибо за ваш отзыв!\");\r\n      });\r\n    });\r\n  });\r\n});\r\n","var Feedback = (function () {\r\n  // Ну малость наговнякал. Извиняюсь\r\n  var FEEDBACK_URL = \"/feedback.php\";\r\n  var $form = $(\".js-popup-feedback-action\");\r\n  $form.each(function (i, item) {\r\n    // Перебираем все формы в с классом\r\n    $(item).on(\"submit\",function (e) {\r\n      _export.sendFeedback(e);\r\n    });\r\n  });\r\n  $(\".js-feedback-rate\").on(\"click\",function () {\r\n    // При заказе тыкая на лицо\r\n    _export.sendRate($(this));\r\n  });\r\n  var _export = {\r\n    initValid: function () {\r\n      // Хз когда то было нужно\r\n    },\r\n    showPopup: function (params) {\r\n      // Попап с обратной свзяью\r\n      $.fancybox.open({\r\n        src: \"#popup_feedback_\" + params.action,\r\n        type: \"inline\"\r\n      });\r\n    }, \r\n    sendFeedback: function (e) {\r\n      e.preventDefault();\r\n      var query = \"msg_action=\" + $(e.target).attr(\"data-action\") + \"&\" + $(e.target).serialize();\r\n      $.post(FEEDBACK_URL, query).then(function(resp){\r\n        resp = JSON.parse(resp);\r\n        if(resp.status == \"success\"){\r\n          $.fancybox.close();\r\n        } else {\r\n          // Перебираем поля для указания валидности\r\n          for(var key in resp.valid){\r\n            var $item = $(\".popup__feedback__container *[name=\" + key + \"]\");\r\n            if(!resp.valid[key]) $item.addClass(\"input_invalid\");\r\n            else $item.removeClass(\"input_invalid\");\r\n          }\r\n        }\r\n        setTimeout(function () {\r\n          Toast.createToast({content: resp.message, type: resp.status});\r\n        },300);\r\n      })\r\n    },\r\n    sendRate: function (self) {\r\n      var query = \"msg_action=score&value=\" + $(self).attr(\"data-feedback-rate\") + \"&id=\" + $(self).attr(\"data-feedback-rate\");\r\n      $.post(FEEDBACK_URL, query).then(function(resp){\r\n        console.log(resp);\r\n      });\r\n    },\r\n    sendSubscribe: function (self) {\r\n      var query = \"msg_action=subscribe&\" + $(self).serialize();\r\n      $.post(FEEDBACK_URL,query).then(function(resp){\r\n        $(self).html('<span class=\"highlight-text_green\">' + Config.strings.feedbackSubscribe + \"</span>\");\r\n      });\r\n    }\r\n  };\r\n  return _export;\r\n})();\r\n"]}